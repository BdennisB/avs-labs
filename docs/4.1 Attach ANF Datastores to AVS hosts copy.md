4.1- "Attach ANF Datastores to AVS hosts copy"
---

# Introduction

Azure NetApp Files is an enterprise-class, high-performance, metered file storage service. The service supports the most demanding enterprise file-workloads in the cloud: databases, SAP, and high-performance computing applications, with no code changes. For more information on Azure NetApp Files, see Azure NetApp Files documentation.

Azure VMware Solution supports attaching Network File System (NFS) datastores as a persistent storage option. You can create NFS datastores with Azure NetApp Files volumes and attach them to clusters of your choice. You can also create virtual machines (VMs) for optimal cost and performance.

By using NFS datastores backed by Azure NetApp Files, you can expand your storage instead of scaling the clusters. 

Create your Azure VMware Solution and create Azure NetApp Files NFS volumes in the virtual network connected to it using an ExpressRoute. Ensure there's connectivity from the private cloud to the NFS volumes created. Use those volumes to create NFS datastores and attach the datastores to clusters of your choice in a private cloud. As a native integration, no other permissions configured via vSphere are needed.

The following diagram demonstrates a typical architecture of Azure NetApp Files backed NFS datastores attached to an Azure VMware Solution private cloud via ExpressRoute.

![](/Images/ANF/architecture.png) 

<details>

## Overview of steps that need to be done

### Azure networking 
* Create a VNET containing a gateway subnet and a delegated subnet in the same region as where your private cloud sits
* Use Azure VNET connect facility in the connectivity blade of the private cloud to create a gateway and connect it into it
 
 (Deployment for this is roughly 15 minutes)
 
 ![Lab schema](/Images/schema/VNETSDDC.png)
 
 ![Lab schema](/Images/schema/VNETSDDC2.png)

* Change the ExR GW SKU from standard to Ultra

 (Deployment for this is roughly 35 minutes)
 
 ![Lab schema](/Images/schema/VNETSDDC3.png)
 
 * Enable fastpath for the private cloud connection into that ExR GW

 (deployment is roughly 2 minutes)
 
  ![Lab schema](/Images/schema/VNETSDDC4.png)
 
### Azure Netapp Files

Following all that configuration work on the Azure side we are now finally ready to get going with the actual NetApp side of things
Staring with 
* Create a Netapp Account
 
  ![Lab schema](/Images/schema/VNETSDDC5.png)
 
 Make sure to create the account in the same region as where your SDDC sits
 
* Add a capacitypool 
 
  ![Lab schema](/Images/schema/VNETSDDC6.png)
 
 
 Leave QOS on auto
 The capacity pool can be shrunk or extended after having created it without any service interuption
 
* Add a volume to the capacity pool
 
  ![Lab schema](/Images/schema/VNETSDDC7.png)
 
Make sure to pick the right VNET and either pick or create a delegated subnet from here inside that VNET.  The subnet delegtion needs to be done to Microsoft.NetAppVolumes
 
 
  Click on protocol
 
 ![Lab schema](/Images/schema/VNETSDDC8.png)

 Watch out for:
 * the protocol type - needs to be NFS
 * the check box Azure VMware Solution DataStore! <- DO NOT forget this (easily overlooked)
 
Deployment takes around 5 minutes
                                                     
With the volume now setup correctly lets make it visible and ready for us in the AVS SDDC
Go to the storage blade in the SDDC
                                                     
 ![Lab schema](/Images/schema/VNETSDDC9.png)

Click on Azure NetApp Files volume on the top
                                                     
 ![Lab schema](/Images/schema/VNETSDDC10.png)

Lets tie it all together, the capacity pool, volume, which cluster you want to make it visible for and the name the datastore should carry
                                                     
The datastore should now be visible in vCenter.  Lets double check.

### AVS - vCenter
                                                     
 ![Lab schema](/Images/schema/VNETSDDC11.png)

This completes the Azure NetApp files as a datastore part
